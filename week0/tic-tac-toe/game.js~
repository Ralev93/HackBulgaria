"use strict";
var prompt = require("sync-prompt").prompt;

function printBoard(board) {
  var
    i = 0, // j = 0,
    n = board.length;// m = board[0].length,
 //   row = "";

  // keep in mind that this is poorly-written JavaScript code
  // we will learn not to use for loops in JavaScript
 /* for(i; i < n; i++) {
    for(j; j < m; j ++) {
      // this is string concatenation
      row += board[i][j];
    }
    console.log(row);
  }*/

  for(i; i < n; i++) {
    console.log(board[i].join(""));

  }

/*
board = [ ["*"],["*"],["*"],
              ["*"],["*"],["*"],
              ["*"],["*"],["*"]
             ],
  for (i; i < n; i++) {
    row += board[i][0];
    if (j%3 === 0 ) {
      console.log(row);
      row = "";
     }
   j++;
  }

  */
}

function win(board, symb) {

var check = true,
    n = board.length;

  for (var i = 0; i < n; i++) {
    for (var j = 0;  j < n - 1 ; j++)
      check = check && (board[i][j] == board[i][j+1] == symb ); 
    if (check) 
      return true;    
  }

  check = true;

  for ( i = 0; i < n - 1; i++) {
    check = check && board[i][i] == board[i+1][i+1] == symb;

  }

  if (check) 
    return true; 

  check = true;

  for ( i = 0 ; i < n; i++) {
    check = check && board[n-i-1][i] == symb == board[n-i-2][i+1];
  }

return check;


}
// entry point for the game
function gameLoop() {
  var
    board = [ ["*", "*", "*"],
              ["*", "*", "*"],
              ["*", "*", "*"]
             ],
    xTurn = true,
    position = null;

  var user1 = prompt("Enter the name of user1: "), 
      user2 = prompt("Enter the name of user2: ");

  while(true) {


    console.log("This is the current state of the board:");
    printBoard(board);

    if(xTurn) {
      console.log("Place for " + user1);
    } else {
      console.log("Place for " + user2);
    }

    // this is blocking prompt
    position = prompt("x y>").split(" ");
    console.log(position);


   var n1 = parseInt(position[0],10),
       n2 = parseInt(position[1],10);

    if (n1 < 1 || n2 < 1 || n1 > board[0].length || n2 > board.length) {
      console.log("Invalid position!!!");
      continue;
    }

    if (xTurn)
      board[n1-1][n2-1] = "X"; 
    else 
      board[n1-1][n2-1] = "O";

    if ( win(board,"X")) {
       console.log(user1 + " winned!");
       return; 
     }
     else { 
      console.log(user2 + " winned!");
      return;
    }


    xTurn = !xTurn;

  
  }
}

gameLoop();
